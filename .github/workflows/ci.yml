name: Java CI con Maven

# CuÃ¡ndo ejecutar este workflow
on:
  push:
    branches: [ main, develop ] # revise si tiene que cambiar main por master
  pull_request:
    branches: [ main ]

# Permisos necesarios
permissions:
  contents: read

jobs:
  build:
    name: Build y Test
    runs-on: ubuntu-latest

    steps:
      # Paso 1: Descargar el cÃ³digo del repositorio
      - name: ðŸ“¥ Checkout del cÃ³digo
        uses: actions/checkout@v4

        # Paso 2: Configurar JDK
      - name: â˜• Configurar JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: maven

      # Paso 3: Compilar el proyecto
      - name: ðŸ”¨ Compilar con Maven
        run: mvn clean compile

      # Paso 4: Ejecutar tests
      - name: ðŸ§ª Ejecutar tests
        run: mvn test

      # Paso 5: Generar reporte de tests
      - name: ðŸ“Š Generar reporte de tests
        if: always()
        run: mvn surefire-report:report

      # Paso 6: Generar artefacto JAR
      - name: ðŸ“¦ Empaquetar aplicaciÃ³n
        run: mvn package -DskipTests

      # Paso 7: Subir el JAR como artefacto
      - name: ðŸ“¤ Subir JAR
        uses: actions/upload-artifact@v4
        with:
          name: calculadora-jar
          path: target/*.jar
          retention-days: 5

      # Paso 8: Mensaje de Ã©xito
      - name: âœ… Build exitoso
        if: success()
        run: |
          echo " Â¡Todos los tests pasaron correctamente!"
          echo " Artefacto JAR generado y disponible"     
          
